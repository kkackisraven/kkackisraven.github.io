<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEORAB - POLYGON MAKER</title>
    <style>
        body { background-color: #222; margin: 0; width: 100vw; height: 100vh; overflow: hidden; display: flex; font-family: sans-serif; }
        
        /* ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        #panel {
            width: 300px; background: #111; color: #eee; padding: 20px; border-right: 1px solid #444;
            display: flex; flex-direction: column; gap: 10px; z-index: 100;
        }
        h3 { margin: 0 0 10px 0; color: cyan; }
        .btn-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 20px; }
        button { padding: 10px; cursor: pointer; border: 1px solid #555; background: #333; color: white; text-align: left; }
        button:hover { background: #444; }
        button.active { background: cyan; color: black; font-weight: bold; border-color: cyan; }
        
        textarea { width: 100%; height: 200px; background: #000; color: #0f0; border: 1px solid #555; font-size: 11px; margin-top: auto; }

        /* ì˜¤ë¥¸ìª½ ë¬´ëŒ€ */
        #stage-wrap { flex-grow: 1; display: flex; justify-content: center; align-items: center; background: #333; position: relative; }
        
        #mobile-stage {
            position: relative;
            height: 90vh; 
            aspect-ratio: 9 / 19.5; /* ì•„ì´í° ë¹„ìœ¨ */
            background-color: #fff; 
            box-shadow: 0 0 20px black;
            cursor: crosshair; /* ì‹­ìì„  ì»¤ì„œ */
            user-select: none;
        }

        /* ì´ë¯¸ì§€ */
        .m-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: none; }
        #m-bg { opacity: 1; }
        /* ìœ„ì¹˜ ì°¸ê³ ìš© ê°€êµ¬ë“¤ (ë°˜íˆ¬ëª…) */
        .furniture { opacity: 0.6; }

        /* í´ë¦­ í¬ì¸íŠ¸ (ì ) */
        .dot {
            position: absolute; width: 6px; height: 6px; background: red; border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none; z-index: 9999; border: 1px solid white;
        }

        /* ì™„ì„±ëœ ì˜ì—­ (í´ë¦¬ê³¤) */
        .polygon-zone {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 0, 0, 0.4); /* ë°˜íˆ¬ëª… ë¹¨ê°• */
            border: 1px solid rgba(255, 0, 0, 0.8);
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="panel">
        <h3>ğŸ“ ê¼­ì§“ì  ì°ê¸° ë„êµ¬</h3>
        <p>ëŒ€ìƒì„ ì„ íƒí•˜ê³ , í™”ë©´ì—ì„œ <strong>ê¼­ì§“ì  4ê°œ</strong>ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
        
        <div class="btn-group">
            <button onclick="selectTarget('switch', this)">1. ìŠ¤ìœ„ì¹˜ (Switch)</button>
            <button onclick="selectTarget('drawer', this)">2. ì™¼ìª½ ì„œë (Left Drawer)</button>
            <button onclick="selectTarget('cabinet', this)">3. ì˜¤ë¥¸ìª½ ìºë¹„ë‹› (Cabinet)</button>
            <button onclick="selectTarget('poster', this)">4. í¬ìŠ¤í„° (Poster)</button>
            <button onclick="selectTarget('schedule', this)">5. ì¼ì •í‘œ (Schedule)</button>
            <button onclick="selectTarget('box', this)">6. íƒë°°ë°•ìŠ¤ (Box)</button>
        </div>

        <button onclick="resetCurrent()" style="background: #552222;">â†º ë‹¤ì‹œ ì°ê¸° (Reset)</button>
        <button onclick="generateCode()" style="background: #225522; margin-top:10px;">ğŸ’¾ ì½”ë“œ ìƒì„± (Generate)</button>
        
        <textarea id="output" readonly>ì¢Œí‘œë¥¼ ë‹¤ ì°ê³  [ì½”ë“œ ìƒì„±]ì„ ëˆ„ë¥´ì„¸ìš”.</textarea>
    </div>

    <div id="stage-wrap">
        <div id="mobile-stage" onclick="handleStageClick(event)">
            <img src="m_bg.png" class="m-layer" id="m-bg">
            <img src="m_switch_on.png" class="m-layer furniture">
            <img src="m_drawer_default.png" class="m-layer furniture">
            <img src="m_cabinet_default.png" class="m-layer furniture">
            <img src="m_poster.png" class="m-layer furniture">
            <img src="m_schedule.png" class="m-layer furniture">
            
            <div id="polygon-layer"></div>
        </div>
    </div>

    <script>
        let currentTarget = null;
        let points = [];
        let allPolygons = {}; // ê²°ê³¼ ì €ì¥ì†Œ

        // 1. ëŒ€ìƒ ì„ íƒ
        function selectTarget(name, btn) {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            currentTarget = name;
            points = []; // ì  ì´ˆê¸°í™”
            updateDots(); // í™”ë©´ ì  ì§€ìš°ê¸°
        }

        // 2. í™”ë©´ í´ë¦­ (ì  ì°ê¸°)
        function handleStageClick(e) {
            if (!currentTarget) {
                alert("ì™¼ìª½ì—ì„œ ë¨¼ì € [ëŒ€ìƒ]ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }
            if (points.length >= 4) {
                alert("ì´ë¯¸ 4ê°œë¥¼ ë‹¤ ì°ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•˜ë ¤ë©´ [ë‹¤ì‹œ ì°ê¸°]ë¥¼ ëˆ„ë¥´ì„¸ìš”.");
                return;
            }

            const stage = document.getElementById('mobile-stage');
            const rect = stage.getBoundingClientRect();

            // í´ë¦­í•œ ìœ„ì¹˜ (í”½ì…€)
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // ë°±ë¶„ìœ¨(%)ë¡œ ë³€í™˜ â˜…í•µì‹¬â˜…
            const perX = ((x / rect.width) * 100).toFixed(2);
            const perY = ((y / rect.height) * 100).toFixed(2);

            points.push({ x: perX, y: perY });
            
            // ì  í‘œì‹œ
            updateDots();

            // 4ê°œ ë‹¤ ì°ì—ˆìœ¼ë©´? -> í´ë¦¬ê³¤ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
            if (points.length === 4) {
                savePolygon();
            }
        }

        // 3. ì  ê·¸ë¦¬ê¸°
        function updateDots() {
            // ê¸°ì¡´ ì  ì‚­ì œ
            document.querySelectorAll('.dot').forEach(d => d.remove());
            
            const stage = document.getElementById('mobile-stage');
            points.forEach(p => {
                const dot = document.createElement('div');
                dot.className = 'dot';
                dot.style.left = p.x + '%';
                dot.style.top = p.y + '%';
                stage.appendChild(dot);
            });
        }

        // 4. í´ë¦¬ê³¤ ì €ì¥ ë° ë¯¸ë¦¬ë³´ê¸°
        function savePolygon() {
            // clip-path: polygon(x1 y1, x2 y2, x3 y3, x4 y4);
            const polyStr = `polygon(${points[0].x}% ${points[0].y}%, ${points[1].x}% ${points[1].y}%, ${points[2].x}% ${points[2].y}%, ${points[3].x}% ${points[3].y}%)`;
            
            allPolygons[currentTarget] = polyStr;

            // í™”ë©´ì— ë¹¨ê°„ ì˜ì—­ ê·¸ë¦¬ê¸° (ê¸°ì¡´êº¼ ì§€ìš°ê³ )
            const oldZone = document.getElementById(`poly-${currentTarget}`);
            if (oldZone) oldZone.remove();

            const zone = document.createElement('div');
            zone.id = `poly-${currentTarget}`;
            zone.className = 'polygon-zone';
            zone.style.clipPath = polyStr;
            // ë¼ë²¨
            zone.innerHTML = `<span style="background:black; color:white; font-size:10px;">${currentTarget}</span>`;
            
            document.getElementById('polygon-layer').appendChild(zone);
        }

        // 5. ë‹¤ì‹œ ì°ê¸°
        function resetCurrent() {
            if (!currentTarget) return;
            points = [];
            updateDots();
            delete allPolygons[currentTarget];
            const oldZone = document.getElementById(`poly-${currentTarget}`);
            if (oldZone) oldZone.remove();
        }

        // 6. ìµœì¢… ì½”ë“œ ìƒì„±
        function generateCode() {
            let css = "/* ëª¨ë°”ì¼ ê¼­ì§“ì  ì¢Œí‘œ */\n";
            
            // ìˆœì„œëŒ€ë¡œ ì¶œë ¥
            const order = ['switch', 'drawer', 'cabinet', 'poster', 'schedule', 'box'];
            
            order.forEach(key => {
                if (allPolygons[key]) {
                    css += `#zone-m-${key} {\n`;
                    css += `    width: 100%; height: 100%; top: 0; left: 0;\n`;
                    css += `    clip-path: ${allPolygons[key]};\n`;
                    css += `}\n`;
                }
            });

            const txt = document.getElementById('output');
            txt.value = css;
            txt.select();
        }
    </script>
</body>
</html>
