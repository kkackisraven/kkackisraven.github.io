<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEORAB Project - BUG FIX</title>
    <style>
        /* [기본 설정] */
        body {
            margin: 0; padding: 0;
            background-color: #000;
            width: 100vw; height: 100vh;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        /* [무대] */
        #stage {
            position: relative;
            width: 100%; height: 100%;
            max-width: 177.78vh; /* 16:9 비율 유지 */
            aspect-ratio: 16 / 9;
        }

        /* [그룹 박스] */
        .group {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
        }

        /* === [그림 순서 (Z-Index)] === */
        .bg-base { z-index: 1; }
        #group-drawer { z-index: 5; }
        #group-cabinet { z-index: 15; }
        #group-switch { z-index: 20; }

        /* [이미지 공통] */
        .layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: contain;
            display: block;
            /* 부드러운 전환 효과 추가 */
            transition: opacity 0.1s ease-in-out;
        }

        /* [숨김 처리] */
        /* important를 써서 확실하게 숨김 */
        .hidden { display: none !important; opacity: 0 !important; }

        /* === [클릭 영역] === */
        .click-zone {
            position: absolute; z-index: 999; cursor: pointer; background-color: transparent;
        }
        #zone-switch { top: 2.59%; left: 42.68%; width: 1.60%; height: 5.61%; }
        #zone-cabinet { top: 39.67%; left: 44.00%; width: 13.65%; height: 11.80%; }
        #zone-drawer {
            width: 100%; height: 100%; top: 0; left: 0;
            clip-path: polygon(32.32% 76.56%, 44.01% 60.96%, 44.29% 65.55%, 33.21% 80.14%);
        }
    </style>
</head>
<body>

    <div id="stage">
        
        <img src="main.png?v=bugfix" class="layer bg-base" id="bg-img">

        <div id="group-drawer" class="group">
            <img src="left_drawer_default.png?v=bugfix" class="layer state-closed">
            <img src="left_drawer_blank.png?v=bugfix" class="layer state-open hidden">
            <img src="left_drawer_open.png?v=bugfix" class="layer state-open hidden">
        </div>

        <div id="group-cabinet" class="group">
            <img src="center_cabinet_default.png?v=bugfix" class="layer state-closed">
            <img src="center_cabinet_cutout.png?v=bugfix" class="layer state-cutout hidden">
            <img src="center_cabinet_blank.png?v=bugfix" class="layer state-open hidden">
            <img src="center_cabinet_open.png?v=bugfix" class="layer state-open hidden">
        </div>

        <div id="group-switch" class="group">
            <img src="switch_on.png?v=bugfix" class="layer switch-on">
            <img src="switch_off.png?v=bugfix" class="layer switch-off hidden">
        </div>

        <div class="click-zone" id="zone-switch" onclick="handleSwitch()"></div>
        <div class="click-zone" id="zone-drawer" onclick="handleDrawer()"></div>
        <div class="click-zone" id="zone-cabinet" onclick="handleCabinet()"></div>

    </div>

    <script>
        // === 기능 스크립트 ===
        
        // 1. 스위치 (★ 버그 수정됨)
        function handleSwitch() {
            const group = document.getElementById('group-switch');
            const on = group.querySelector('.switch-on');
            const off = group.querySelector('.switch-off');
            
            const targets = [
                document.getElementById('bg-img'),
                document.getElementById('group-drawer'),
                document.getElementById('group-cabinet')
            ];

            // 켜져있으면 -> 끈다 (Dark Mode)
            if (off.classList.contains('hidden')) {
                // ★ 핵심: 먼저 ON을 확실히 숨기고, 아주 잠깐 뒤에 OFF를 보여준다.
                on.classList.add('hidden');
                setTimeout(() => {
                    off.classList.remove('hidden');
                    targets.forEach(el => el.style.filter = "brightness(0.4)");
                }, 10); // 0.01초 딜레이
            } 
            // 꺼져있으면 -> 켠다 (Light Mode)
            else {
                // ★ 핵심: 먼저 OFF를 확실히 숨기고, 아주 잠깐 뒤에 ON을 보여준다.
                off.classList.add('hidden');
                setTimeout(() => {
                    on.classList.remove('hidden');
                    targets.forEach(el => el.style.filter = "brightness(1)");
                }, 10); // 0.01초 딜레이
            }
        }

        // 2. 왼쪽 서랍 (캐비닛 교체 로직 포함)
        function handleDrawer() {
            const drawerGroup = document.getElementById('group-drawer');
            const cabinetGroup = document.getElementById('group-cabinet');
            const d_closed = drawerGroup.querySelector('.state-closed');
            const d_opens = drawerGroup.querySelectorAll('.state-open');
            const c_default = cabinetGroup.querySelector('.state-closed');
            const c_cutout = cabinetGroup.querySelector('.state-cutout');
            const c_opens = cabinetGroup.querySelectorAll('.state-open');

            // 열기
            if (!d_closed.classList.contains('hidden')) {
                d_closed.classList.add('hidden');
                d_opens.forEach(el => el.classList.remove('hidden'));
                // 캐비닛 교체 (시간차 적용)
                c_default.classList.add('hidden');
                c_opens.forEach(el => el.classList.add('hidden'));
                setTimeout(() => c_cutout.classList.remove('hidden'), 10);
            } 
            // 닫기
            else {
                d_closed.classList.remove('hidden');
                d_opens.forEach(el => el.classList.add('hidden'));
                // 캐비닛 복구 (시간차 적용)
                c_cutout.classList.add('hidden');
                c_opens.forEach(el => el.classList.add('hidden'));
                setTimeout(() => c_default.classList.remove('hidden'), 10);
            }
        }

        // 3. 가운데 캐비닛
        function handleCabinet() { toggleGroup('group-cabinet'); }

        function toggleGroup(id) {
            const group = document.getElementById(id);
            const closed = group.querySelector('.state-closed');
            const cutout = group.querySelector('.state-cutout'); 
            const openImgs = group.querySelectorAll('.state-open');

            // 열기
            if (!closed.classList.contains('hidden') || (cutout && !cutout.classList.contains('hidden'))) {
                closed.classList.add('hidden');
                if(cutout) cutout.classList.add('hidden'); 
                setTimeout(() => openImgs.forEach(img => img.classList.remove('hidden')), 10);
            } 
            // 닫기
            else {
                openImgs.forEach(img => img.classList.add('hidden'));
                const drawerOpen = !document.querySelector('#group-drawer .state-closed').classList.contains('hidden');
                setTimeout(() => {
                    if(drawerOpen && cutout) cutout.classList.remove('hidden');
                    else closed.classList.remove('hidden');
                }, 10);
            }
        }
    </script>
</body>
</html>
