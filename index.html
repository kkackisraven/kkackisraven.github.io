<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEORAB - FINAL ROBUST</title>
    <style>
        /* 1. 기본 뼈대 */
        body { margin: 0; padding: 0; background-color: #000; width: 100vw; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        #stage { position: relative; width: 100%; height: 100%; max-width: 177.78vh; aspect-ratio: 16 / 9; }

        /* 2. 이미지 공통 (애니메이션 제거) */
        .layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: contain; display: block;
            pointer-events: none; /* 이미지는 클릭 무시 */
        }

        /* 3. 숨김 클래스 (가장 강력하게) */
        .d-none { display: none !important; }

        /* 4. ★ 레이어 순서 (Z-Index) 재정립 ★ */
        /* 숫자가 클수록 내 눈앞에 보임 */
        
        /* 1층: 배경 */
        #img-bg { z-index: 1; }

        /* 2층: 닫힌 서랍들 (바닥에 깔림) */
        #img-drawer-closed { z-index: 5; }
        
        /* 3층: 캐비닛 (평소엔 서랍보다 위) */
        /* 중요: 서랍이 열리면 이놈들은 숨겨지고 cutout이 나옴 */
        #img-cabinet-default { z-index: 10; }
        #img-cabinet-cutout { z-index: 10; }
        #img-cabinet-open { z-index: 10; }
        #img-cabinet-blank { z-index: 10; }

        /* 4층: 열린 서랍 (캐비닛보다 위로 올라와야 함!) */
        #img-drawer-open { z-index: 20; }
        #img-drawer-blank { z-index: 20; }

        /* 5층: 스위치 (맨 위) */
        #img-switch-on { z-index: 100; }
        #img-switch-off { z-index: 100; }

        /* 5. 클릭 영역 (투명 버튼) */
        .click-zone { position: absolute; z-index: 999; cursor: pointer; background: transparent; }

        /* 좌표값 적용 */
        #zone-switch { top: 2.59%; left: 42.68%; width: 1.60%; height: 5.61%; }
        #zone-cabinet { top: 39.67%; left: 44.00%; width: 13.65%; height: 11.80%; }
        #zone-drawer {
            width: 100%; height: 100%; top: 0; left: 0;
            clip-path: polygon(32.32% 76.56%, 44.01% 60.96%, 44.29% 65.55%, 33.21% 80.14%);
        }

    </style>
</head>
<body>

    <div id="stage">
        
        <img src="main.png?v=final3" class="layer" id="img-bg">

        <img src="left_drawer_default.png?v=final3" class="layer" id="img-drawer-closed">
        <img src="left_drawer_open.png?v=final3" class="layer d-none" id="img-drawer-open">
        <img src="center_cabinet_default.png?v=final3" class="layer" id="img-cabinet-default">
        <img src="center_cabinet_cutout.png?v=final3" class="layer d-none" id="img-cabinet-cutout">
        <img src="center_cabinet_open.png?v=final3" class="layer d-none" id="img-cabinet-open">
        
        <img src="switch_on.png?v=final3" class="layer" id="img-switch-on">
        <img src="switch_off.png?v=final3" class="layer d-none" id="img-switch-off">


        <div class="click-zone" id="zone-switch" onclick="toggleSwitch()"></div>
        <div class="click-zone" id="zone-drawer" onclick="toggleDrawer()"></div>
        <div class="click-zone" id="zone-cabinet" onclick="toggleCabinet()"></div>

    </div>

    <script>
        // === [상태 관리 시스템] ===
        // 현재 상태를 변수로 저장해두고, 이 변수에 맞춰서 그림을 그립니다.
        // 꼬일 일이 없습니다.
        
        let state = {
            isDark: false,      // false: 켜짐, true: 꺼짐
            drawer: 'closed',   // 'closed' or 'open'
            cabinet: 'closed'   // 'closed' or 'open'
        };

        // 1. 화면 그리기 함수 (무조건 얘를 통합니다)
        function render() {
            // [A] 스위치 처리
            const swOn = document.getElementById('img-switch-on');
            const swOff = document.getElementById('img-switch-off');
            const targets = [ // 밝기 조절 대상
                document.getElementById('img-bg'),
                document.getElementById('img-drawer-closed'),
                document.getElementById('img-drawer-open'),
                document.getElementById('img-cabinet-default'),
                document.getElementById('img-cabinet-cutout'),
                document.getElementById('img-cabinet-open')
            ];

            if (state.isDark) {
                // 꺼짐 상태
                swOn.classList.add('d-none');
                swOff.classList.remove('d-none');
                targets.forEach(el => el.style.filter = "brightness(0.4)");
            } else {
                // 켜짐 상태
                swOff.classList.add('d-none');
                swOn.classList.remove('d-none');
                targets.forEach(el => el.style.filter = "brightness(1)");
            }

            // [B] 서랍 & 캐비닛 처리 (여기가 핵심!)
            const d_closed = document.getElementById('img-drawer-closed');
            const d_open = document.getElementById('img-drawer-open');
            
            const c_default = document.getElementById('img-cabinet-default');
            const c_cutout = document.getElementById('img-cabinet-cutout');
            const c_open = document.getElementById('img-cabinet-open');

            // 1. 일단 다 숨깁니다. (초기화)
            d_closed.classList.add('d-none');
            d_open.classList.add('d-none');
            c_default.classList.add('d-none');
            c_cutout.classList.add('d-none');
            c_open.classList.add('d-none');

            // 2. 상태에 따라 필요한 것만 켭니다.
            
            // (서랍 상태 확인)
            if (state.drawer === 'open') {
                d_open.classList.remove('d-none'); // 서랍 열림 그림 표시
            } else {
                d_closed.classList.remove('d-none'); // 서랍 닫힘 그림 표시
            }

            // (캐비닛 상태 확인)
            if (state.cabinet === 'open') {
                // 캐비닛이 열려있으면 -> 무조건 열린 그림
                c_open.classList.remove('d-none');
            } else {
                // 캐비닛이 닫혀있으면 -> 서랍 눈치를 봐야 함
                if (state.drawer === 'open') {
                    // 서랍이 열려있네? -> 파낸 캐비닛(cutout) 보여줘!
                    c_cutout.classList.remove('d-none');
                } else {
                    // 서랍도 닫혀있네? -> 그냥 캐비닛(default) 보여줘!
                    c_default.classList.remove('d-none');
                }
            }
        }

        // === [클릭 이벤트 함수들] ===
        
        function toggleSwitch() {
            state.isDark = !state.isDark;
            render(); // 화면 갱신
        }

        function toggleDrawer() {
            if (state.drawer === 'closed') state.drawer = 'open';
            else state.drawer = 'closed';
            render(); // 화면 갱신
        }

        function toggleCabinet() {
            if (state.cabinet === 'closed') state.cabinet = 'open';
            else state.cabinet = 'closed';
            render(); // 화면 갱신
        }

        // 초기 실행
        render();

    </script>
</body>
</html>
