<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SEORAB - EDITOR v3 (FIXED)</title>
    <style>
        body { background-color: #222; margin: 0; width: 100vw; height: 100vh; overflow: hidden; display: flex; }
        
        /* ì™¼ìª½ ì •ë³´ì°½ */
        #info-panel {
            width: 350px; background: #111; color: #ccc; padding: 20px; font-family: monospace;
            z-index: 99999; border-right: 1px solid #444; overflow-y: auto; display: flex; flex-direction: column;
        }
        #info-panel h3 { margin-top: 0; color: yellow; }
        textarea { width: 100%; height: 300px; background: #000; color: #0f0; border: 1px solid #555; font-size: 12px; flex-grow: 1; margin-bottom: 10px; }
        button { width:100%; padding:15px; cursor:pointer; background:yellow; border:none; font-weight:bold; font-size: 16px; color: black;}

        /* ë¬´ëŒ€ */
        #stage-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; background: #333; padding: 20px; }
        #stage {
            position: relative;
            width: 100%; max-width: 177.78vh; aspect-ratio: 16 / 9;
            background: #000; border: 2px solid cyan;
        }

        /* === [ìˆ˜ì •ë¨] ì´ë¯¸ì§€ ê°•ì œ í‘œì‹œ ì„¤ì • === */
        /* ëª¨ë“  ì´ë¯¸ì§€ë¥¼ í™”ë©´ ê½‰ ì°¨ê²Œ, ê·¸ë¦¬ê³  ë§¨ ìœ„ë¡œ ì˜¬ë¼ì˜¤ê²Œ í•¨ */
        .layer { 
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%; 
            object-fit: contain; 
            pointer-events: none; 
            display: block !important; /* ê°•ì œ í‘œì‹œ */
        }

        /* ë°°ê²½ì€ ë§¨ ë’¤ì— */
        .bg { z-index: 1; opacity: 1; }

        /* ì„œë/ìºë¹„ë‹› ë“±ì€ ë°˜íˆ¬ëª…í•˜ê²Œ ë³´ì—¬ì„œ ìœ„ì¹˜ ì¡ê¸° í¸í•˜ê²Œ í•¨ */
        .obj { z-index: 10; opacity: 0.7; }

        /* ê·¸ë£¹ ë°•ìŠ¤ í¬ê¸° ë³µêµ¬ (ì´ê±° ì—†ìœ¼ë©´ ë˜ ì•ˆ ë³´ì„) */
        .group {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ ë¹¨ê°„ ë°•ìŠ¤ */
        .click-zone {
            position: absolute;
            z-index: 1000;
            background-color: rgba(255, 0, 0, 0.5);
            border: 1px solid rgba(255,255,255,0.5);
            cursor: move;
            resize: both;
            overflow: hidden;
            min-width: 10px; min-height: 10px;
        }
        .click-zone::after {
            content: attr(data-name);
            color: white; font-size: 10px; padding: 2px; display: block; background: rgba(0,0,0,0.7); white-space: nowrap;
        }
        .click-zone.active { border: 2px solid yellow; background-color: rgba(255, 255, 0, 0.3); z-index: 1001; }

        /* ì´ˆê¸° ìœ„ì¹˜ */
        #zone-switch { top: 35%; left: 45%; width: 5%; height: 8%; }
        #zone-cabinet { top: 50%; left: 52%; width: 12%; height: 15%; }
        #zone-drawer-1 { top: 55%; left: 32%; width: 5%; height: 5%; }
        #zone-drawer-2 { top: 60%; left: 34%; width: 5%; height: 5%; }
        #zone-drawer-3 { top: 65%; left: 36%; width: 5%; height: 5%; }

    </style>
</head>
<body>

    <div id="info-panel">
        <h3>ğŸ“ ê³µì‚¬íŒ ëª¨ë“œ v3</h3>
        <p>ì´ì œ ê·¸ë¦¼ë“¤ì´ íë¦¿í•˜ê²Œ ë³´ì¼ ê²ë‹ˆë‹¤.<br>ê·¸ ìœ„ì— ë¹¨ê°„ ë°•ìŠ¤ë¥¼ ë§ì¶”ì„¸ìš”.</p>
        <textarea id="result-code" readonly>ìœ„ì¹˜ë¥¼ ì¡ê³  ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</textarea>
        <button onclick="updateCoords()">ì¢Œí‘œ ì¶”ì¶œí•˜ê¸°</button>
    </div>

    <div id="stage-container">
        <div id="stage">
            <img src="main.png?v=final" class="layer bg">

            <div class="group"><img src="left_drawer_default.png?v=final" class="layer obj"></div>
            <div class="group"><img src="center_cabinet_default.png?v=final" class="layer obj"></div>
            <div class="group"><img src="switch_on.png?v=final" class="layer obj"></div>

            <div class="click-zone" id="zone-switch" data-name="ìŠ¤ìœ„ì¹˜"></div>
            <div class="click-zone" id="zone-cabinet" data-name="ê°€ìš´ë° ìºë¹„ë‹›"></div>
            
            <div class="click-zone" id="zone-drawer-1" data-name="ì„œë(ìƒ)"></div>
            <div class="click-zone" id="zone-drawer-2" data-name="ì„œë(ì¤‘)"></div>
            <div class="click-zone" id="zone-drawer-3" data-name="ì„œë(í•˜)"></div>
        </div>
    </div>

    <script>
        const zones = document.querySelectorAll('.click-zone');
        let activeItem = null;
        let startX, startY, startLeft, startTop;

        zones.forEach(zone => {
            zone.addEventListener('mousedown', dragStart);
        });

        function dragStart(e) {
            if (e.offsetX > e.target.clientWidth - 15 && e.offsetY > e.target.clientHeight - 15) return;
            zones.forEach(z => z.classList.remove('active'));
            e.target.classList.add('active');
            activeItem = e.target;
            startX = e.clientX;
            startY = e.clientY;
            startLeft = activeItem.offsetLeft;
            startTop = activeItem.offsetTop;
            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
        }

        function dragMove(e) {
            if (!activeItem) return;
            e.preventDefault();
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            const parent = activeItem.parentElement;
            const newLeft = ((startLeft + dx) / parent.clientWidth) * 100;
            const newTop = ((startTop + dy) / parent.clientHeight) * 100;
            activeItem.style.left = newLeft + "%";
            activeItem.style.top = newTop + "%";
        }

        function dragEnd() {
            activeItem = null;
            document.removeEventListener('mousemove', dragMove);
            document.removeEventListener('mouseup', dragEnd);
        }

        function updateCoords() {
            const stage = document.getElementById('stage');
            let result = "";
            zones.forEach(zone => {
                let t = (zone.offsetTop / stage.clientHeight * 100).toFixed(2);
                let l = (zone.offsetLeft / stage.clientWidth * 100).toFixed(2);
                let w = (zone.offsetWidth / stage.clientWidth * 100).toFixed(2);
                let h = (zone.offsetHeight / stage.clientHeight * 100).toFixed(2);
                result += `/* ${zone.getAttribute('data-name')} */\n#${zone.id} { top: ${t}%; left: ${l}%; width: ${w}%; height: ${h}%; }\n`;
            });
            const textarea = document.getElementById('result-code');
            textarea.value = result;
            textarea.select();
        }
    </script>
</body>
</html>
