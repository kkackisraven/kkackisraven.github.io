<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SEORAB - POLYGON EDITOR</title>
    <style>
        body { background-color: #222; margin: 0; width: 100vw; height: 100vh; overflow: hidden; display: flex; }
        
        /* ì •ë³´ì°½ */
        #info-panel {
            width: 350px; background: #111; color: #ccc; padding: 20px; font-family: monospace;
            z-index: 99999; border-right: 1px solid #444; overflow-y: auto; display: flex; flex-direction: column;
        }
        #info-panel h3 { margin-top: 0; color: #0f0; }
        textarea { width: 100%; height: 200px; background: #000; color: #0f0; border: 1px solid #555; font-size: 12px; flex-grow: 1; margin-bottom: 10px; }
        button { width:100%; padding:15px; cursor:pointer; background:#0f0; border:none; font-weight:bold; font-size: 16px; color: black;}

        /* ë¬´ëŒ€ */
        #stage-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; background: #333; padding: 20px; }
        #stage {
            position: relative;
            width: 100%; max-width: 177.78vh; aspect-ratio: 16 / 9;
            background: #000; border: 2px solid cyan;
            user-select: none;
        }

        /* ì´ë¯¸ì§€ë“¤ */
        .layer { 
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%; 
            object-fit: contain; pointer-events: none; 
            display: block !important;
        }
        .bg { z-index: 1; opacity: 1; }
        .obj { z-index: 10; opacity: 0.6; } /* ë°˜íˆ¬ëª… */

        /* === [1. ë„¤ëª¨ ë°•ìŠ¤ (ìŠ¤ìœ„ì¹˜/ìºë¹„ë‹›ìš©)] === */
        .click-zone {
            position: absolute;
            z-index: 1000;
            background-color: rgba(255, 0, 0, 0.4);
            border: 1px solid red;
            cursor: move;
            resize: both;
            overflow: hidden;
            min-width: 20px; min-height: 20px;
        }
        .click-zone::after {
            content: attr(data-name); color: white; font-size: 10px; background: rgba(0,0,0,0.7);
        }
        /* ì´ˆê¸° ìœ„ì¹˜ */
        #zone-switch { top: 35%; left: 45%; width: 5%; height: 8%; }
        #zone-cabinet { top: 50%; left: 52%; width: 12%; height: 15%; }

        /* === [2. í´ë¦¬ê³¤ ì  (ì™¼ìª½ ì„œëìš©)] === */
        .poly-point {
            position: absolute;
            width: 20px; height: 20px;
            background: #0f0; /* ì´ˆë¡ìƒ‰ ì  */
            border-radius: 50%;
            border: 2px solid white;
            z-index: 2000;
            cursor: crosshair;
            transform: translate(-50%, -50%); /* ì ì˜ ì¤‘ì‹¬ì´ ì¢Œí‘œê°€ ë˜ë„ë¡ */
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .poly-point::after {
            content: attr(data-idx); position:absolute; top:-15px; left:5px; color:#0f0; font-weight:bold; font-size:12px;
        }

        /* í´ë¦¬ê³¤ ì˜ì—­ ë¯¸ë¦¬ë³´ê¸° (SVG) */
        svg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1500;
        }
        polygon {
            fill: rgba(0, 255, 0, 0.3); /* ì´ˆë¡ìƒ‰ ì±„ì›€ */
            stroke: #0f0; stroke-width: 2;
        }

    </style>
</head>
<body>

    <div id="info-panel">
        <h3>ğŸ“ í´ë¦¬ê³¤ ì—ë””í„°</h3>
        <p>
            <strong>1. ìŠ¤ìœ„ì¹˜/ìºë¹„ë‹›:</strong> ë¹¨ê°„ ë°•ìŠ¤ ë“œë˜ê·¸.<br><br>
            <strong>2. ì™¼ìª½ ì„œë:</strong> <span style="color:#0f0">ì´ˆë¡ìƒ‰ ì  4ê°œ</span>ë¥¼ ë“œë˜ê·¸í•´ì„œ ì„œëì˜ <strong>ë„¤ ëª¨ì„œë¦¬(ê¼­ì§“ì )</strong>ì— ì •í™•íˆ ì°ìœ¼ì„¸ìš”.<br><br>
            <strong>3. ì™„ë£Œë˜ë©´:</strong> ì•„ë˜ ë²„íŠ¼ í´ë¦­!
        </p>
        <textarea id="result-code" readonly>ì¤€ë¹„ ì™„ë£Œ.</textarea>
        <button onclick="updateCoords()">ì¢Œí‘œ ì¶”ì¶œí•˜ê¸°</button>
    </div>

    <div id="stage-container">
        <div id="stage" id="main-stage">
            <img src="main.png?v=final" class="layer bg">
            <img src="left_drawer_default.png?v=final" class="layer obj">
            <img src="center_cabinet_default.png?v=final" class="layer obj">
            <img src="switch_on.png?v=final" class="layer obj">

            <svg>
                <polygon id="poly-preview" points="0,0 0,0 0,0 0,0"></polygon>
            </svg>

            <div class="click-zone" id="zone-switch" data-name="ìŠ¤ìœ„ì¹˜"></div>
            <div class="click-zone" id="zone-cabinet" data-name="ê°€ìš´ë° ìºë¹„ë‹›"></div>

            <div class="poly-point" id="p1" data-idx="1" style="top:55%; left:30%;"></div>
            <div class="poly-point" id="p2" data-idx="2" style="top:55%; left:40%;"></div>
            <div class="poly-point" id="p3" data-idx="3" style="top:70%; left:40%;"></div>
            <div class="poly-point" id="p4" data-idx="4" style="top:70%; left:30%;"></div>
        </div>
    </div>

    <script>
        const stage = document.getElementById('stage');
        
        // === 1. ë„¤ëª¨ ë°•ìŠ¤ ë“œë˜ê·¸ (ê¸°ì¡´) ===
        const zones = document.querySelectorAll('.click-zone');
        let activeZone = null;
        let zX, zY, zL, zT;

        zones.forEach(zone => zone.addEventListener('mousedown', startZoneDrag));

        function startZoneDrag(e) {
            if (e.target.classList.contains('poly-point')) return; // ì  í´ë¦­ì´ë©´ íŒ¨ìŠ¤
            if (e.offsetX > e.target.clientWidth - 15 && e.offsetY > e.target.clientHeight - 15) return; // ë¦¬ì‚¬ì´ì¦ˆ
            activeZone = e.target;
            zX = e.clientX; zY = e.clientY;
            zL = activeZone.offsetLeft; zT = activeZone.offsetTop;
            document.addEventListener('mousemove', moveZone);
            document.addEventListener('mouseup', endZone);
        }
        function moveZone(e) {
            if(!activeZone) return;
            e.preventDefault();
            const dx = e.clientX - zX; const dy = e.clientY - zY;
            activeZone.style.left = ((zL + dx) / stage.clientWidth * 100) + "%";
            activeZone.style.top = ((zT + dy) / stage.clientHeight * 100) + "%";
        }
        function endZone() {
            activeZone = null;
            document.removeEventListener('mousemove', moveZone);
            document.removeEventListener('mouseup', endZone);
        }

        // === 2. í´ë¦¬ê³¤ ì  ë“œë˜ê·¸ (ì‹ ê·œ) ===
        const points = document.querySelectorAll('.poly-point');
        const polyPreview = document.getElementById('poly-preview');
        let activePoint = null;

        points.forEach(p => p.addEventListener('mousedown', startPointDrag));

        function startPointDrag(e) {
            activePoint = e.target;
            document.addEventListener('mousemove', movePoint);
            document.addEventListener('mouseup', endPoint);
        }

        function movePoint(e) {
            if(!activePoint) return;
            e.preventDefault();
            
            // ë¬´ëŒ€ ê¸°ì¤€ ì¢Œí‘œ ê³„ì‚°
            const rect = stage.getBoundingClientRect();
            let x = e.clientX - rect.left;
            let y = e.clientY - rect.top;

            // %ë¡œ ë³€í™˜í•´ì„œ ì €ì¥
            activePoint.style.left = (x / rect.width * 100) + "%";
            activePoint.style.top = (y / rect.height * 100) + "%";
            
            drawPolygon(); // ì„  ê·¸ë¦¬ê¸°
        }

        function endPoint() {
            activePoint = null;
            document.removeEventListener('mousemove', movePoint);
            document.removeEventListener('mouseup', endPoint);
            drawPolygon();
        }

        // SVG ê·¸ë¦¬ê¸°
        function drawPolygon() {
            const rect = stage.getBoundingClientRect();
            let pts = "";
            points.forEach(p => {
                // % ìœ„ì¹˜ë¥¼ ë‹¤ì‹œ í”½ì…€ë¡œ ë°”ê¿”ì„œ SVGì— ì…ë ¥ (ë¯¸ë¦¬ë³´ê¸°ìš©)
                let x = parseFloat(p.style.left) / 100 * rect.width;
                let y = parseFloat(p.style.top) / 100 * rect.height;
                pts += `${x},${y} `;
            });
            polyPreview.setAttribute('points', pts);
        }

        // ì´ˆê¸° ì‹¤í–‰
        drawPolygon();
        window.addEventListener('resize', drawPolygon);

        // === 3. ì¢Œí‘œ ì¶”ì¶œ (ìµœì¢…) ===
        function updateCoords() {
            let result = "/* == ë³µì‚¬í•´ì„œ ì£¼ì„¸ìš” == */\n\n";

            // 1. ë„¤ëª¨ ë°•ìŠ¤ ì¢Œí‘œ
            zones.forEach(zone => {
                let t = (zone.offsetTop / stage.clientHeight * 100).toFixed(2);
                let l = (zone.offsetLeft / stage.clientWidth * 100).toFixed(2);
                let w = (zone.offsetWidth / stage.clientWidth * 100).toFixed(2);
                let h = (zone.offsetHeight / stage.clientHeight * 100).toFixed(2);
                result += `#${zone.id} { top: ${t}%; left: ${l}%; width: ${w}%; height: ${h}%; }\n`;
            });

            // 2. í´ë¦¬ê³¤ ì¢Œí‘œ (í•µì‹¬)
            let polyCoords = "";
            points.forEach((p, index) => {
                let x = parseFloat(p.style.left).toFixed(2);
                let y = parseFloat(p.style.top).toFixed(2);
                polyCoords += `${x}% ${y}%`;
                if (index < points.length - 1) polyCoords += ", ";
            });

            result += `\n/* ì™¼ìª½ ì„œë (í´ë¦¬ê³¤) */\n#group-drawer { \n    clip-path: polygon(${polyCoords}); \n    /* í´ë¦¬ê³¤ì€ ì „ì²´ í™”ë©´ì„ ë‹¤ ë®ê³  êµ¬ë©ë§Œ ëš«ëŠ” ë°©ì‹ */\n    width: 100%; height: 100%; top: 0; left: 0; pointer-events: auto; cursor: pointer;\n}`;

            const textarea = document.getElementById('result-code');
            textarea.value = result;
            textarea.select();
        }
    </script>
</body>
</html>
